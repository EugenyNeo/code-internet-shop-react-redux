import React from 'react'
import {connect} from 'react-redux'
import {
  getBasketItemsWithCount,
  getTotalBasketPrice
} from 'selectors'
import {Link} from 'react-router-dom'
import * as R from 'ramda'
import {removeItemFromBasket, basketCheckout, cleanBasket} from 'actions'

const Basket = ({
                  items,
                  totalPrice,
                  removeItemFromBasket,
                  basketCheckout,
                  cleanBasket}) => {
  const isBasketEmty =R.isEmpty(items)
  const renderContent =()=>{
    return (
      <div>
        {isBasketEmty && <div>Your shopping cart is empty</div>}
        <div className='table-responsive'>
          <table className='table-border table-striped table-condensed cf'>
            <tbody>
            {items.map((item, index) =>(
              <tr
                key={index}
                className='item-checout'
              >
                <td className='first-column-checkout'>
                  <img
                  className='img-thumbnail'
                  src={item.image}
                  alt={item.name}
                  />
                </td>
                <td>{item.name}</td>
                <td>{item.price}</td>
                <td>{item.count}</td>
                <td>
                  <span
                    className='delete-cart'
                    onClick={()=>removeItemFromBasket(item.id)}
                  ></span>
                </td>
              </tr>
            ))}
            </tbody>
          </table>
        </div>
        {R.not(isBasketEmty) &&
          <div className='row'>
            <div className='pull-right total-user-checkout'>
              <b>Total:</b>
              ${totalPrice}
            </div>
          </div>
        }
      </div>
    )
  }
  const renderSidebar =()=>{
   return (
     <div>
       <Link
       to='/'
       className='btn btn-info'
       >
         <span className='glyphicon glyphicon-info-sign'></span>
         <span>Continue Shopping!</span>
       </Link>
       {R.not(isBasketEmty) &&
       <div>
         <button onClick={cleanBasket}
         className='btn btn-danger'
         >
           <span className='glyphicon glyphicon-trash'></span>
          Clean cart
         </button>
         <button
          className='btn btn-success'
         onClick={()=> basketCheckout(items)}
         >
        <span className='glyphicon glyphicon-envelop'></span>
           Checkout
         </button>
       </div>}
     </div>
   )
 }
  return  (
   <div className='view-container'>
     <div className='container'>
       <div className='row'>
         <div className='col-md-9'>
           {renderContent()}
         </div>
         <div className=' col-md-3 btn-user-checkout '>
           {renderSidebar()}
         </div>
       </div>
     </div>

   </div>
  )
}

const mapStateToProps = state =>{
  return {
    items: getBasketItemsWithCount(state),
    totalPrice: getTotalBasketPrice(state)
  }
}

const mapDispatchToProps = {
  removeItemFromBasket,
  cleanBasket,
  basketCheckout
}

export default connect(mapStateToProps, mapDispatchToProps)(Basket)